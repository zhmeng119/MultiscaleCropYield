---
title: "Report: Multi-scale estimation of crop yield"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
knitr::opts_knit$set(root.dir = "..")
```

## Introduction
A maize field dataset was collected at Whittier Farms, in Sutton, MA. In this project, we are going to use Mark micro-meteorology estimates and Sentinel-2 1C level data to predict maize yields. 

#### Goals
- What is the overall aim of the project and what specific Earth Observation problem is it trying to solve?

  This project is aiming to compare the maize yield results generated from data with different spatial scales, and hopefully, the comparison can help us understand what are the key elements that are affecting the predicted yield.

#### Equations

```{r, out.width = "100%", echo=FALSE, fig.align='center'}
knitr::include_graphics("./Docs/figures/Equations.png")
```


```{r, echo=FALSE}

```

## Data

### Part 1: Pod data

#### Daily
Here is an expample of `daily` pod data.
```{r}
library(dplyr)

# read data from cvs
data_d <- read.csv(file = "Data/Pod_A000680_daily.csv")
# take a quick of the data 
sample_d <- data_d %>% select(.,time,device,Cl,NDVI,SWdw) %>% slice(85:95)
head(sample_d)
```
We can see that there are `NA` values in the dataset, which will do harm to the calculation of `APRA`. Therefore, we will introduce preprocess function to the dataset to get rid of `NA` values.

#### Hourly
Here is an expample of `hourly` pod data.
```{r}
# read data from cvs
data_h <- read.csv(file = "Data/Pod_A000680_hourly.csv")
# take a quick of the data 
sample_h <- data_h %>% select(.,time,device,PARdw,PARuw,SWdw) %>% slice(85:95)
head(sample_h)
```

### Part 2: Sentinel 2 processed data

The data is pulled from GoogleEarthEngine based on the location of pod A000680, A000671, A000667.

#### Daily
```{r}
gee_pod680_2018 <- read.csv(file = 'Data/EO_pod_NDVI_data/pod680_2018.csv')
gee_pod680_2019 <- read.csv(file = 'Data/EO_pod_NDVI_data/pod680_2019.csv')

head(gee_pod680_2018 %>% select(.,date, NDVI))
head(gee_pod680_2019 %>% select(.,date, NDVI))
```
We can see there are repeated date values in the raw data, so we will `aggregate` the repeated values by `mean`. And we also notice that the Sentinel 2 data is not generated daily due to the temporal resolution.


## Method


```{r , echo=FALSE}

```

## Result

### Yield prediction based on pod data (ε = 4.2, HI = 0.7)
```{r, eval=FALSE}
# Results of APAR
                2018     2019
APAR_Pod680 43540.34 31586.62
APAR_Pod671 44077.92 33530.94
APAR_Pod667 45864.11 32117.12

# Results of Yield 
                 2018     2019
Yield_Pod680 128008.6 92864.66
Yield_Pod671 129589.1 98580.96
Yield_Pod667 134840.5 94424.33
```

### Results of comparison between pod data and  Sentinel 2 - 1C data
There are 35 records in 2018, and 31 in 2019. Therefore, the `Yield` value will be smaller than the pod based data.

```{r  eval = FALSE}
# Pod
                     2018     2019
testYield_Pod680 19738.87 12957.23
testYield_Pod671 19480.00 13256.72
testYield_Pod667 19928.53 13297.09

# Sentinel 2 -1C
                     2018      2019
Yield_sat_pod680 14814.60 10293.292
Yield_sat_pod671 14367.76 10871.309
Yield_sat_pod667 14954.93  9827.617
```

## Summary

## References

- Lobell, D. B., Asner, G. P., Ortiz-Monasterio, J. I., & Benning, T. L. (2003). Remote sensing of regional crop production in the Yaqui Valley, Mexico: estimates and uncertainties. Agriculture, Ecosystems & Environment, 94(2), 205-220.

- “Carbon Balance CERES 2010.Ppsx.” Dropbox. https://www.dropbox.com/s/v8ony8cgyh29erv/Carbon%20Balance%20CERES%202010.ppsx?dl=0 (May 2, 2020).

- Agroimpacts/Geog287387. 2020. Agricultural Impacts Research Group. HTML. https://github.com/agroimpacts/geog287387 (May 2, 2020).















